#+latex_class: cn-article
#+title: Unity Android SDK/NDK 俄罗斯方块砖3D　小游戏
#+author: deepwaterooo 

* 模块搭建
- ILRuntime的消化理解，以及与MVVM同用时的搭配理解消化
- 热更新模块服务器模块的理解与消化搭建：

* 把原理弄懂
- 热更新模块的实充：以前的设计模式和实现的功能还是比较完整的；现在更成熟一点儿，需要把热更新模块补充出来；
- ILRuntime + MVVM框架设计：两者结合，前几年的时候没能把MVVM理解透彻；
- 上次前几年主要的难点：好像是在把MVVM双向数据绑定理解得不透彻；那么这次应该就狠没有问题了，更该寻求更好的设计与解决方案
- 性能优化：另外是对其实高级开发的越来越熟悉，希望应用的性能表现，尤其是渲染性能与速度等、这些更为高级和深入的特性成为这次二次开发的重点。

- 现在是把自己几年前的写的游戏全忘记了，需要回去把自己的源码找出来，再读一读熟悉一下自己的源码，了解当时设计的估缺点，由此改进更将

* 环境弄得比较好的包括：
- 输入法的搭建：终于用到了自己之前用过的好用的输入法
- 这两天开车疲累，最迟明天中午会去南湾找房间出租，尽快解决搬家的问题；昨天晚上回来得太晚了，一路辛苦，路上只差睡着，回到家里补觉补了好多个小时。
- 小电脑，笔记本电脑里的游戏环境搭建，今天下午去图书馆里弄（今天下午去图书馆里把需要借助快速网络来完成的事情都搭建好；家里被恶房东故意整了个腾腾慢的网，故意阻碍别人的发展，谁还愿意再这样的环境中继续住下去呢？！！！）

* ILRuntime 库的系统再深入理解
** ILRuntime基本原理#
- ILRuntime借助Mono.Cecil库来读取DLL的PE信息，以及当中类型的所有信息，最终得到方法的IL汇编码，然后通过内置的IL解译执行虚拟机来执行DLL中的代码。IL解释器代码在ILIntepreter.cs，通过Opcode来逐语句执行机器码，解释器的代码有四千多行。
  
[[./pic/readme_20220926_094936.png]]
** ILRuntime热更流程
   
[[./pic/readme_20220926_095022.png]]
** ILRuntime主要限制
   
[[./pic/readme_20220926_095555.png]]
** ILRuntime启动调试#
- ILRuntime建议全局只创建一个AppDomain，在函数入口添加代码启动调试服务
#+BEGIN_SRC csharp
appdomain.DebugService.StartDebugService(56000)
#+END_SRC 
- 运行主工程(Unity工程)
- 在热更的VS工程中 点击 - 调试 - 附加到ILRuntime调试，注意使用一样的端口
- 如果使用VS2015的话需要Visual Studio 2015 Update3以上版本
** 线上项目和资料#
- 掌趣很多项目都是使用ILRuntime开发，并上线运营，比如：真红之刃，境·界 灵压对决，全民奇迹2，龙族世界，热血足球
- 初音未来:梦幻歌姬 使用补丁方式：https://github.com/wuxiongbin/XIL
- 本文流程图摘自：ILRuntime的QQ群的《ILRuntime热更框架.docx》(by a 704757217)
- Unity实现c#热更新方案探究(三): https://zhuanlan.zhihu.com/p/37375372

